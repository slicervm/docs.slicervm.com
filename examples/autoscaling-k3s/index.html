
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Slice bare-metal into sandboxes and services">
      
      
        <meta name="author" content="OpenFaaS Ltd">
      
      
        <link rel="canonical" href="https://docs.slicervm.com/examples/autoscaling-k3s/">
      
      
        <link rel="prev" href="../ha-k3s/">
      
      
        <link rel="next" href="../large-scale-k3s/">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Autoscaling Kubernetes - Slicer</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto,+Helvetica:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto, Helvetica";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#autoscaling-kubernetes-k3s-with-cluster-autoscaler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Slicer" class="md-header__button md-logo" aria-label="Slicer" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Slicer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Autoscaling Kubernetes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/slicervm/docs.slicervm.com" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    slicervm/docs.slicervm.com
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../.." class="md-tabs__link">
          
  
  Slicer for Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mac/overview/" class="md-tabs__link">
          
  
  Slicer for Mac

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Slicer" class="md-nav__button md-logo" aria-label="Slicer" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Slicer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/slicervm/docs.slicervm.com" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    slicervm/docs.slicervm.com
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Slicer for Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Slicer for Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact us
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/walkthrough/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Walkthrough
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/daemon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running in the background
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" checked>
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run-a-task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run a one-shot task via API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_4_2" id="__nav_1_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_4_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ha-k3s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HA Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Autoscaling Kubernetes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Autoscaling Kubernetes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptual-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-watch-a-video-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Demo: Watch a video walkthrough
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-setup-the-control-plane-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Setup the Control Plane nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-11-install-k3s-on-the-control-plane-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1.1: Install K3s on the control plane nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-setup-worker-node-host-group" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Setup Worker Node Host Group
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-21-enroll-other-machines" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2.1: Enroll other machines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-networking" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Configure Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Configure Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Deploy Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-update-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      How to update the configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-the-expander-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the Expander mode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-ca-bundle-for-slicer-api" class="md-nav__link">
    <span class="md-ellipsis">
      Custom CA Bundle for Slicer API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-the-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Test the Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../large-scale-k3s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Large scale Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiple-machine-k3s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple machine Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k3s-gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s with a GPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openfaas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFaaS on K3s
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_4_3" >
        
          
          <label class="md-nav__link" for="__nav_1_4_3" id="__nav_1_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI/LLMs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            AI/LLMs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpu-ollama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ollama with a GPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opencode-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Headless OpenCode Coding Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cursor-cli-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Headless Cursor Coding Agent
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_4_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4_4" id="__nav_1_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Productivity
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4_4">
            <span class="md-nav__icon md-icon"></span>
            Productivity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../buildkit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Docker builds over SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote-vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote VSCode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pihole-adblock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PiHole Adblocker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jenkins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Jenkins for CI/CD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../router-firewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a Linux Router/Firewall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run containers with Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openfaas-edge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFaaS Edge (All-In-One)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/userdata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customise with userdata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/copy-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Copy files to/from a VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/execute-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execute commands in a VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/expose-ports/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Expose ports from a VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/custom-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build a custom root filesystem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logs & Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/share-files-with-nfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Share files over NFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/nested-virtualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nested Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/pvm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run slicer without KVM on cloud VMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/execute-commands-with-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execute commands in VMs with the SDK
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Storage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/zfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/devmapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Devmapper
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slicer REST API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Images for microVMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH access to VMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/secrets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secret management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial Over SSH (SOS)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/vfio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VFIO Passthrough
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Slicer for Mac
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Slicer for Mac
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/linux-vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/sandboxes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sandboxes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/rosetta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enable Rosetta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/folder-sharing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folder sharing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/sleep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sleep behavior
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/tray-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tray integration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mac/coding-agents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding agents
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptual-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-watch-a-video-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Demo: Watch a video walkthrough
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-setup-the-control-plane-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Setup the Control Plane nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-11-install-k3s-on-the-control-plane-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1.1: Install K3s on the control plane nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-setup-worker-node-host-group" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Setup Worker Node Host Group
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-21-enroll-other-machines" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2.1: Enroll other machines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-networking" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Configure Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Configure Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Deploy Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-update-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      How to update the configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-the-expander-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the Expander mode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-ca-bundle-for-slicer-api" class="md-nav__link">
    <span class="md-ellipsis">
      Custom CA Bundle for Slicer API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-the-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Test the Cluster Autoscaler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="autoscaling-kubernetes-k3s-with-cluster-autoscaler">Autoscaling Kubernetes (k3s) with Cluster Autoscaler<a class="headerlink" href="#autoscaling-kubernetes-k3s-with-cluster-autoscaler" title="Permanent link">&para;</a></h1>
<p>The Cluster Autoscaler is a controller offered by the Kubernetes community to add and remove nodes to a Kubernetes cluster based upon demand.</p>
<p>When run in the cloud such as AWS, Azure, GCP, etc, the autoscaler provisions nodes using the cloud provider's VM primitive, so EC2 for AWS, Google Compute Engine for GCP, etc.</p>
<p>With Slicer it launches Firecracker microVMs on one or more Slicer hosts. So you can build massive clusters at home or in your own datacentre.</p>
<ul>
<li>Adds new Kubernetes nodes via Slicer's REST API</li>
<li>Removes nodes when they are no longer needed</li>
<li>Acts in a similar way to spot instances (ephemeral nodes)</li>
</ul>
<h2 id="conceptual-overview">Conceptual Overview<a class="headerlink" href="#conceptual-overview" title="Permanent link">&para;</a></h2>
<p><a href="/images/slicer-autoscaler-conceptual.png"><img alt="Slicer Autoscaler Conceptual Overview" src="/images/slicer-autoscaler-conceptual.png" /></a></p>
<blockquote>
<p>Slicer Autoscaler Conceptual Overview running across two separate machines.</p>
</blockquote>
<p><strong>Control Plane</strong></p>
<p>The Control Plane nodes will be setup statically via YAML configuration on one Slicer host. The default is 3, but you could increase that if you wished.</p>
<p>The Cluster Autoscaler will be deployed in-cluster using Helm, with a TOML file that defines the node groups and their scaling parameters, and which Slicer API and Token URL to use.</p>
<p><strong>Workers / Agents</strong></p>
<p>The workers or agents will be provisioned as required by the Cluster Autoscaler, pointing at one or most hosts running Slicer's REST API.</p>
<h2 id="demo-watch-a-video-walkthrough">Demo: Watch a video walkthrough<a class="headerlink" href="#demo-watch-a-video-walkthrough" title="Permanent link">&para;</a></h2>
<p>If you'd like to see how it works, you can watch a <a href="https://www.youtube.com/watch?v=MHXvhKb6PpA">walkthrough video on YouTube</a>.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/MHXvhKb6PpA?si=AerZGyu30zm-cRDF" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2 id="step-1-setup-the-control-plane-nodes">Step 1: Setup the Control Plane nodes<a class="headerlink" href="#step-1-setup-the-control-plane-nodes" title="Permanent link">&para;</a></h2>
<p>On the first Slicer host, the one that will run the control plane run the following steps.</p>
<p>Create and deploy a 3-node K3s control plane. This will serve as the foundation for your autoscaling cluster. For detailed instructions on Highly Available K3s setup with Slicer, see the <a href="/examples/ha-k3s">HA K3s example</a>.</p>
<p>Use <code>slicer new</code> to generate a configuration file for the control plane nodes.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create control plane configuration</span>
slicer<span class="w"> </span>new<span class="w"> </span>k3s-cp<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ram<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--count<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cidr<span class="w"> </span><span class="m">192</span>.168.137.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>&gt;<span class="w"> </span>k3s-cp.yaml
</code></pre></div>
<p>The values above are suggestions that we've tested, but you can customise the specifications to your own needs.</p>
<ul>
<li><code>--cpu</code> - the number of virtual CPUs to allocate to each control plane VM</li>
<li><code>--ram</code> - the amount of RAM in GB to allocate to each control plane VM</li>
<li><code>--count</code> - the number of control plane VMs to create</li>
<li><code>--cidr</code> - the CIDR block to use for the control plane network (best not to change this until you've run the whole tutorial successfully)</li>
</ul>
<p>Then start up the control plane nodes:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Deploy control plane</span>
sudo<span class="w"> </span>slicer<span class="w"> </span>up<span class="w"> </span>./k3s-cp.yaml
sudo<span class="w"> </span>slicer<span class="w"> </span>vm<span class="w"> </span>list<span class="w"> </span>--json<span class="w"> </span>&gt;<span class="w"> </span>devices.json
</code></pre></div>
<h2 id="step-11-install-k3s-on-the-control-plane-nodes">Step 1.1: Install K3s on the control plane nodes<a class="headerlink" href="#step-11-install-k3s-on-the-control-plane-nodes" title="Permanent link">&para;</a></h2>
<p>Move over to your workstation.</p>
<p>Copy the devices.json file to your workstation.</p>
<p>Add the route that you were given when starting up Slicer to your machine.</p>
<p>Install K3s across all control plane nodes using K3sup Pro. K3sup Pro automates the installation process, setting up the first server and then joining the remaining servers in parallel:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Download K3sup Pro (included with Slicer)</span>
curl<span class="w"> </span>-sSL<span class="w"> </span>https://get.k3sup.dev<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">PRO</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>sh
k3sup-pro<span class="w"> </span>activate

<span class="c1"># Create K3s cluster</span>
k3sup-pro<span class="w"> </span>plan<span class="w"> </span>--user<span class="w"> </span>ubuntu<span class="w"> </span>./devices.json
k3sup-pro<span class="w"> </span>apply

<span class="c1"># Get kubeconfig and join token</span>
k3sup-pro<span class="w"> </span>get-config<span class="w"> </span>--local-path<span class="w"> </span>~/k3s-cp-kubeconfig
k3sup-pro<span class="w"> </span>node-token<span class="w"> </span>--user<span class="w"> </span>ubuntu<span class="w"> </span>--host<span class="w"> </span><span class="m">192</span>.168.137.2<span class="w"> </span>&gt;<span class="w"> </span>~/k3s-join-token.txt
</code></pre></div>
<p>The kubeconfig is required so that you can use kubectl to manage the cluster. There are additional flags if you want to merge this into your existing kubeconfig file under a new context name such as:</p>
<div class="highlight"><pre><span></span><code>k3sup-pro<span class="w"> </span>get-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--local-path<span class="w"> </span>~/.kube/config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--context<span class="w"> </span>slicer-k3s-cp
</code></pre></div>
<p>The <code>k3sup-pro node-token</code> command fetches the token that K3s will use to add new agents/workers into the cluster, and will be consumed by the Cluster Autoscaler when it is deployed.</p>
<h2 id="step-2-setup-worker-node-host-group">Step 2: Setup Worker Node Host Group<a class="headerlink" href="#step-2-setup-worker-node-host-group" title="Permanent link">&para;</a></h2>
<p>Create a separate Slicer instance for autoscaled worker nodes. This could be done on the same machine as the control plane, or a different one.</p>
<p>Note that the CIDR block must be different for each Slicer instance.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create worker node host group (starting with 0 nodes)</span>
slicer<span class="w"> </span>new<span class="w"> </span>k3s-agents-1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ram<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cidr<span class="w"> </span><span class="m">192</span>.168.138.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--count<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tap-prefix<span class="o">=</span><span class="s2">&quot;k3sa1&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-bind<span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-port<span class="o">=</span><span class="m">8081</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--find-ssh-keys<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ssh-port<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>&gt;<span class="w"> </span>k3s-agents-1.yaml

<span class="c1"># Deploy worker host group</span>
sudo<span class="w"> </span>slicer<span class="w"> </span>up<span class="w"> </span>./k3s-agents-1.yaml
</code></pre></div>
<p>This host group starts with zero nodes (<code>count=0</code>). The Cluster Autoscaler will call the Slicer API to dynamically add nodes to this group based on scheduling demands.</p>
<p>Retrieve the API token from this Slicer instance. This token will be used by the Cluster Autoscaler to authenticate with the Slicer API when provisioning new worker nodes:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On the worker node host</span>
sudo<span class="w"> </span>cat<span class="w"> </span>/var/lib/slicer/auth/token
</code></pre></div>
<p>Save the value on your workstation as <code>~/slicer-token-1.txt</code>.</p>
<p>You can repeat this process on multiple hosts to create additional worker node groups if needed.</p>
<h2 id="step-21-enroll-other-machines">Step 2.1: Enroll other machines<a class="headerlink" href="#step-21-enroll-other-machines" title="Permanent link">&para;</a></h2>
<p>If you have additional machines that could run Slicer and provide Kubernetes nodes, you can add them by following the instructions above.</p>
<p>This could be an Arm64 machine (Ampere, Raspberry Pi, etc) or an x86_64 (Intel, AMD, etc) machine.</p>
<p>For each, make sure you change:</p>
<ul>
<li>the CIDR block</li>
<li>the tap-prefix</li>
<li>the API port</li>
<li>the name of the host group</li>
</ul>
<p>The API port doesn't strictly need to be changed if you run every Slicer instance on a different physical machine, however we've changed it since you may wish to try this out all on one computer.</p>
<p>I.e. to add <code>k3s-agents-2</code>:</p>
<div class="highlight"><pre><span></span><code>slicer<span class="w"> </span>new<span class="w"> </span>k3s-agents-2<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ram<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cidr<span class="w"> </span><span class="m">192</span>.168.139.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--count<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tap-prefix<span class="o">=</span><span class="s2">&quot;k3sa2&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-bind<span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-port<span class="o">=</span><span class="m">8082</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--find-ssh-keys<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ssh-port<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>&gt;<span class="w"> </span>k3s-agents-2.yaml
</code></pre></div>
<p>Remember to save each Slicer API token to your workstation as <code>~/slicer-token-2.txt</code>, <code>~/slicer-token-3.txt</code>, etc.</p>
<h2 id="step-3-configure-networking">Step 3: Configure Networking<a class="headerlink" href="#step-3-configure-networking" title="Permanent link">&para;</a></h2>
<p>In a Kubernetes cluster, every Node and Pod must be able to communicate with every other Node and Pod.</p>
<p>That means you must configure a number of routes.</p>
<p><strong>Your workstation</strong></p>
<p>On your workstation, you can get away with only adding a route to the Control Plane Slicer instance.</p>
<p><strong>On each worker host</strong></p>
<p>Each worker host must have a route to:</p>
<ul>
<li>The Control Plane Slicer instance</li>
<li>Every other worker node Slicer instance (other than its own)</li>
</ul>
<p><strong>Making it permanent</strong></p>
<p>Routes added with <code>ip route</code> are not permanent, so if your network link goes down, you may have to run them again. If you reboot the machine, you'll need to run them again.</p>
<p>When we run long-term K3s clusters with Slicer this way, we'll create a one-shot systemd unit that adds the correct routes on every boot.</p>
<p>Alternatively, if running at home, you could add these routes via your ISP's router.</p>
<p>For instance, this may be what runs on the control-plane for two separate worker nodes.</p>
<p>Create a file called <code>slicer-routes.service</code>:
<div class="highlight"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Add<span class="w"> </span>slicer<span class="w"> </span>routes
<span class="nv">After</span><span class="o">=</span>network-online.target
<span class="nv">Wants</span><span class="o">=</span>network-online.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/root/add-routes.sh
<span class="nv">RemainAfterExit</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">User</span><span class="o">=</span>root

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div></p>
<p>Then enable the service to run on every boot:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>./slicer-routes.service<span class="w"> </span>/etc/systemd/system/
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>slicer-routes.service
</code></pre></div>
<p>Then create the <code>add-routes.sh</code> script at <code>/root/add-routes.sh</code>.</p>
<p>Copy and paste in the <code>ip route</code> commands that you were given when starting up all your worker nodeSlicer instances.</p>
<h2 id="step-4-configure-cluster-autoscaler">Step 4: Configure Cluster Autoscaler<a class="headerlink" href="#step-4-configure-cluster-autoscaler" title="Permanent link">&para;</a></h2>
<p>Create the cloud configuration file that tells the Cluster Autoscaler how to connect to your K3s cluster and Slicer APIs.</p>
<p>This INI file defines the node groups and their scaling parameters:</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span>./cloud-config.ini<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">[global]</span>
<span class="s">k3s-url=https://192.168.137.2:6443</span>
<span class="s">k3s-token=$(cat ~/k3s-join-token.txt)</span>
<span class="s">default-min-size=0</span>
<span class="s">default-max-size=10</span>

<span class="s">[nodegroup &quot;k3s-agents-1&quot;]</span>
<span class="s">slicer-url=http://192.168.138.1:8081</span>
<span class="s">slicer-token=$(cat ~/slicer-token-1.txt)</span>
<span class="s">EOF</span>
</code></pre></div>
<p>Note that the setting of <code>default-max-size</code> will affect how many nodes can be added to a node group.</p>
<p>If you were to have had two Slicer instances running worker nodes, the config would look like this:</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span>cloud-config.ini<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">[global]</span>
<span class="s">k3s-url=https://192.168.137.2:6443</span>
<span class="s">k3s-token=$(cat ~/k3s-join-token.txt)</span>
<span class="s">default-min-size=0</span>
<span class="s">default-max-size=10</span>

<span class="s">[nodegroup &quot;k3s-agents-1&quot;]</span>
<span class="s">slicer-url=http://192.168.138.1:8081</span>
<span class="s">slicer-token=$(cat ~/slicer-token-1.txt)</span>

<span class="s">[nodegroup &quot;k3s-agents-2&quot;]</span>
<span class="s">slicer-url=http://192.168.139.1:8082</span>
<span class="s">slicer-token=$(cat ~/slicer-token-2.txt)</span>
<span class="s">EOF</span>
</code></pre></div>
<p>In the above example, the Slicer host may be a Raspberry Pi 5, and you should limit how many nodes can run there with an extra setting under the <code>[nodegroup]</code> section:</p>
<p>I set this to <code>4</code> (4x4=16) since the Raspberry Pi 5 has 4 physical cores and 16GB of RAM.</p>
<div class="highlight"><pre><span></span><code><span class="na">max-size</span><span class="o">=</span><span class="s">4</span>
</code></pre></div>
<ul>
<li>The <code>nodegroup</code> name comes from the the hostgroup name of the Slicer instance</li>
<li>The <code>slicer-url</code> is the API URL of the Slicer instance</li>
<li>The <code>slicer-token</code> is the API token of the Slicer instance</li>
<li>The <code>k3s-url</code> is the API URL of the K3s control plane</li>
<li>The <code>k3s-token</code> is the join token for the K3s control plane</li>
<li>The <code>default-min-size</code> is the default minimum number of nodes to scale to</li>
<li>The <code>default-max-size</code> is the default maximum number of nodes to scale to</li>
</ul>
<p>Overview of all available configuration options:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Required</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>global</code></td>
<td>Global configuration options</td>
<td>No</td>
<td>-</td>
</tr>
<tr>
<td><code>global/k3s-url</code></td>
<td>K3s control plane API server URL</td>
<td>Yes</td>
<td>-</td>
</tr>
<tr>
<td><code>global/k3s-token</code></td>
<td>K3s join token for new nodes</td>
<td>Yes</td>
<td>-</td>
</tr>
<tr>
<td><code>global/ca-bundle</code></td>
<td>Path to custom CA bundle file for Slicer API calls</td>
<td>No</td>
<td>-</td>
</tr>
<tr>
<td><code>global/default-min-size</code></td>
<td>Default minimum nodes per group</td>
<td>No</td>
<td>1</td>
</tr>
<tr>
<td><code>global/default-max-size</code></td>
<td>Default maximum nodes per group</td>
<td>No</td>
<td>8</td>
</tr>
<tr>
<td><code>nodegroup/slicer-url</code></td>
<td>Slicer API server URL</td>
<td>Yes</td>
<td>-</td>
</tr>
<tr>
<td><code>nodegroup/slicer-token</code></td>
<td>Slicer API authentication token</td>
<td>Yes</td>
<td>-</td>
</tr>
<tr>
<td><code>nodegroup/min-size</code></td>
<td>Group-specific minimum size</td>
<td>No</td>
<td>global default</td>
</tr>
<tr>
<td><code>nodegroup/max-size</code></td>
<td>Group-specific maximum size</td>
<td>No</td>
<td>global default</td>
</tr>
</tbody>
</table>
<h2 id="step-5-deploy-cluster-autoscaler">Step 5: Deploy Cluster Autoscaler<a class="headerlink" href="#step-5-deploy-cluster-autoscaler" title="Permanent link">&para;</a></h2>
<p>Deploy the Cluster Autoscaler using Helm.</p>
<p>If you don't have Helm, you can install it via <a href="https://arkade.dev">arkade</a> with: <code>arkade get helm</code>.</p>
<p>First, create a Kubernetes secret containing the cloud configuration file:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>cluster-autoscaler-cloud-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>cloud-config<span class="o">=</span>./cloud-config.ini
</code></pre></div>
<p>Create a <code>values-slicer.yaml</code> file to configure the Cluster Autoscaler Helm chart. This configuration specifies the Slicer-compatible autoscaler image, mounts the cloud config secret, and sets appropriate scaling parameters:</p>
<div class="highlight"><pre><span></span><code><span class="nt">fullnameOverride</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slicer-cluster-autoscaler</span>

<span class="nt">image</span><span class="p">:</span>
<span class="w">  </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/openfaasltd/cluster-autoscaler-slicer</span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>

<span class="nt">cloudProvider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slicer</span>

<span class="nt">autoDiscovery</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k3s-slicer</span>

<span class="nt">extraVolumeSecrets</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cluster-autoscaler-cloud-config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-autoscaler-cloud-config</span>
<span class="w">    </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/slicer/</span>
<span class="w">    </span><span class="nt">items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud-config</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud-config</span>

<span class="nt">extraArgs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cloud-config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/slicer/cloud-config</span>
<span class="w">  </span><span class="nt">logtostderr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">stderrthreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="w">  </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="nt">scale-down-enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">scale-down-delay-after-add</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30s&quot;</span>
<span class="w">  </span><span class="nt">scale-down-unneeded-time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30s&quot;</span>
<span class="w">  </span><span class="nt">expendable-pods-priority-cutoff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-10</span>
<span class="w">  </span><span class="nt">expander</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random</span>
</code></pre></div>
<p>You can find other settings for the Cluster Autoscaler in the <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/charts">official Kubernetes autoscaler Helm chart</a>.</p>
<p>Deploy the autoscaler using the official Kubernetes autoscaler Helm chart:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>autoscaler<span class="w"> </span>https://kubernetes.github.io/autoscaler
helm<span class="w"> </span>upgrade<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--install<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>slicer-cluster-autoscaler<span class="w"> </span>autoscaler/cluster-autoscaler<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="o">=</span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="o">=</span>./values-slicer.yaml
</code></pre></div>
<p>Next, a minor patch is required to the ClusterRole so that it can remove nodes from the cluster.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>patch<span class="w"> </span>clusterrole/slicer-cluster-autoscaler<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/rules/4/verbs/-&quot;, &quot;value&quot;: &quot;delete&quot;}]&#39;</span>
</code></pre></div>
<p>You could also edit this manually via <code>kubectl edit clusterrole/slicer-cluster-autoscaler</code>, then add <code>delete</code> to the array of verbs under <code>resources</code> and <code>nodes</code>.</p>
<p>If our fork gets merged into upstream, then this patch will no longer be needed.</p>
<h2 id="how-to-update-the-configuration">How to update the configuration<a class="headerlink" href="#how-to-update-the-configuration" title="Permanent link">&para;</a></h2>
<p>If you got something wrong like a token, URL, or Slicer host group name, or perhaps want to add a new Slicer instance, you'll need to update the INI file.</p>
<p>If you need to update the configuration, then do the following:</p>
<ul>
<li>Update your local INI file</li>
<li>Delete the secret for the Cluster Autoscaler</li>
<li>Re-create the secret</li>
<li>Restart the Cluster Autoscaler</li>
</ul>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>secret<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>cluster-autoscaler-cloud-config

kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>cluster-autoscaler-cloud-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>cloud-config<span class="o">=</span>./cloud-config.ini

kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>slicer-cluster-autoscaler
</code></pre></div>
<h2 id="setting-the-expander-mode">Setting the Expander mode<a class="headerlink" href="#setting-the-expander-mode" title="Permanent link">&para;</a></h2>
<p>Check what expander youre using in the Cluster Autoscaler deployment:</p>
<ul>
<li>
<p><code>--expander=price</code> or <code>--expander=least-waste</code> - will strongly bias towards any group with less RAM/CPU per node</p>
</li>
<li>
<p><code>--expander=random</code> - will randomly pick between suitable groups</p>
</li>
<li>
<p><code>--expander=most-pods</code> - picks the group that fits the most pending pods</p>
</li>
</ul>
<p>If you just want both groups to see some traffic, switching to random or most-pods is usually the simplest.</p>
<p>The expander flag can be set in values.yaml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">extraArgs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">expander</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random</span>
</code></pre></div>
<h2 id="custom-ca-bundle-for-slicer-api">Custom CA Bundle for Slicer API<a class="headerlink" href="#custom-ca-bundle-for-slicer-api" title="Permanent link">&para;</a></h2>
<p>If your Slicer API endpoints use self-signed certificates or certificates signed by a custom Certificate Authority, you can specify a custom CA bundle.</p>
<p>The path the the CA bandle can be configured in the <code>[global]</code> section in the <code>cloud-config.ini</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[global]</span>
<span class="na">ca-bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/etc/ssl/certs/slicer-ca-bundle.pem</span>
</code></pre></div>
<p>The CA bundle file should contain one or more PEM-encoded certificates. This configuration applies globally to all Slicer API calls across all node groups.</p>
<p>When deploying with Helm, you can mount your CA bundle using <code>extraVolumeSecrets</code>.</p>
<p>Create a secret for the CA bundle:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>slicer-ca-bundle<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>ca-bundle<span class="o">=</span>./ca-bundle.pem
</code></pre></div>
<p>Update your values.yaml file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">extraVolumeSecrets</span><span class="p">:</span>
<span class="w">  </span><span class="nt">slicer-ca-bundle</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slicer-ca-bundle</span>
<span class="w">    </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/slicer-ca-bundle.pem</span>
<span class="w">    </span><span class="nt">items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ca-bundle</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ca-bundle</span>
</code></pre></div>
<h2 id="test-the-cluster-autoscaler">Test the Cluster Autoscaler<a class="headerlink" href="#test-the-cluster-autoscaler" title="Permanent link">&para;</a></h2>
<p>The autoscaler works by detecting unschedulable Pods and automatically provisioning new Worker Nodes through Slicer's REST API. Once workloads are removed or reduced, it will scale down unneeded nodes after the configured cooldown period.</p>
<p>The capacity of the Control Plane will mean that you can already launch a large number of Pods without needing any scaling.</p>
<p>Here's how you can force the Cluster Autoscaler to scale:</p>
<ul>
<li>Fill up the Control Plane nodes with Pods</li>
<li>Use taints, tolerations, nodeselector labels, or other affinity rules to prevent Pods from running on the Control Plane nodes</li>
</ul>
<p>You can watch the logs of the autoscaler to understand what it's doing:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Watch autoscaler logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>deployment/slicer-cluster-autoscaler<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-f
</code></pre></div>
<p>In another terminal, ideally a split tmux pane set up the below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Pane 1 - watch nodes being added</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--watch<span class="w"> </span>--output<span class="w"> </span>wide

<span class="c1"># Pane 2 - watch which Pods are unschedulable/Not Ready - that means they&#39;re waiting for a node to be available</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--watch<span class="w"> </span>--output<span class="w"> </span>wide<span class="w"> </span>--all-namespaces
</code></pre></div>
<p>Keep another eye out on Slicer's output on the worker node host. You should see VMs being booted up and / or shutting down.</p>
<p><strong>Simplest option: scale to hundreds of Pods</strong></p>
<p>Create a deployment for busybox's sleep image, and give it fairly big resource requests.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: sleep</span>
<span class="s">spec:</span>
<span class="s">  replicas: 1</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: sleep</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: sleep</span>
<span class="s">    spec:</span>
<span class="s">      terminationGracePeriodSeconds: 0</span>
<span class="s">      containers:</span>
<span class="s">        - name: sleep</span>
<span class="s">          image: docker.io/library/busybox:latest</span>
<span class="s">          command: [&quot;sleep&quot;, &quot;infinity&quot;]</span>
<span class="s">          imagePullPolicy: IfNotPresent</span>
<span class="s">          resources:</span>
<span class="s">            requests:</span>
<span class="s">              cpu: 50m</span>
<span class="s">              memory: 50Mi</span>
<span class="s">EOF</span>
</code></pre></div>
<p>Once the Deployment is created, you can scale it to a moderate or massive number of Pods. Remember that by default, Kubernetes limits each node so it can only run 100 Pods.</p>
<p>Try running the below, and give the system a minute or two to catch up between each.</p>
<p>The below will full up the Control Plane nodes, and worker nodes will be needed to support the excess.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>sleep<span class="w"> </span>--replicas<span class="o">=</span><span class="m">100</span>
kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>sleep<span class="w"> </span>--replicas<span class="o">=</span><span class="m">300</span>
kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>sleep<span class="w"> </span>--replicas<span class="o">=</span><span class="m">400</span>
</code></pre></div>
<p>You'll see the a new Node being added to the cluster, and the Pods being scheduled to run on it.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Watch each Pod coming online, and see which node it gets scheduled to</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--watch<span class="w"> </span>--output<span class="w"> </span>wide

<span class="c1"># Watch nodes coming online to support the new Pods</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--watch<span class="w"> </span>--output<span class="w"> </span>wide
</code></pre></div>
<p><a href="/images/scaling-600-pods.png"><img alt="Scaling to 600 Pods" src="/images/scaling-600-pods.png" /></a></p>
<blockquote>
<p>Example showing 600 Pods running across two Slicer hosts running worker nodes - a Ryzen 9 and a Raspberry Pi 5. The Control Plane is running on a separate N100 fanless mini PC.</p>
</blockquote>
<p>These Pods run a simple <code>sleep infinity</code> command, so they are not doing anything that taxes the system, however you can view Node usage across the cluster with:</p>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span><span class="s2">&quot;kubectl top nodes&quot;</span>
</code></pre></div>
<p><strong>Taints and tolerations</strong></p>
<p>You can use a label to prevent new Pods from running on the Control Plane, and simulate autoscaling.</p>
<p>In production, OpenFaaS customers tend to run their functions on spot instances rather than on their control plane nodes.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-1:NoSchedule
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-2:NoSchedule
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-3:NoSchedule
</code></pre></div>
<p>Now, newly created or restarted Pods will not be scheduled to run on the Control Plane nodes.</p>
<p>Next, you can create a Pod that tolerates the taint, and will be scheduled to run on the Control Plane nodes.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Pod</span>
<span class="s">metadata:</span>
<span class="s">  name: sleep-pod</span>
<span class="s">spec:</span>
<span class="s">  containers:</span>
<span class="s">    - name: sleep</span>
<span class="s">      image: docker.io/library/busybox:latest</span>
<span class="s">      command: [&quot;sleep&quot;, &quot;infinity&quot;]</span>
<span class="s">  tolerations:</span>
<span class="s">    - key: slicer-cp</span>
<span class="s">      operator: Equal</span>
<span class="s">      value: &quot;true&quot;</span>
<span class="s">      effect: NoSchedule</span>
<span class="s">EOF</span>
</code></pre></div>
<p>You'll see the a new Node being added to the cluster, and the Pod being scheduled to run on it.</p>
<p>Finally, remove the Pod and untaint the Control Plane nodes:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>sleep-pod
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-1:NoSchedule-
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-2:NoSchedule-
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>slicer-cp-3:NoSchedule-
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p><strong>Node says as NotReady</strong></p>
<p>Check connectivity and routes. Remember these do not survive an interface going down/up or a reboot.</p>
<p>Remove the mode manually via <code>kubectl delete node/NAME</code>.</p>
<p>Check the Slicer output for the node, perhaps it failed to boot or the network didn't come up in time.</p>
<p><strong>Left over nodes</strong></p>
<p>Delete all nodes that are not part of the control plane, assuming they are all listed as NotReady:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>node<span class="w"> </span>-l<span class="w"> </span>k3sup.dev/node-type<span class="o">=</span>agent
</code></pre></div>
<p><strong>Only one Slicer instance is getting used</strong></p>
<p>The <code>expander</code> setting in values.yaml should be changed to <code>random</code> or <code>most-pods</code> to ensure that all Slicer instances are used.</p>
<p>The default is <code>price</code> and meant for the cloud, where the smallest node types are always picked first.</p>
<p><strong>The Cluster Autoscaler is not picking up new configuration</strong></p>
<p>If you have tainted any nodes, it may mean that the new Pod for the autoscaler cannot be scheduled, so remove the taints.</p>
<p><strong>The Cluster Autoscaler says a node group is not ready</strong></p>
<p>This error was observed during testing, restarting the deployment resolved the issue. We assume the autoscaler has a bug where it doesn't properly check readiness once it decides it's unhealthy.</p>
<p>Message observed: "Readiness for node group k3s-agents-2 not found"</p>
<p><strong>Why are many Pods stuck as Pending?</strong></p>
<p>The logs of the autoscaler are set to a verbose level which will explain most issues.</p>
<p>Look out to see if you've exceeded the maximum number of nodes for a node group i.e. "Skipping node group k3s-agents-1 - max size reached".</p>
<p><strong>Diagnose an issue within a worker node</strong></p>
<p>The <code>slicer vm shell</code> command will give you a root shell directly into any worker node.</p>
<p>On the host managing <code>k3s-agents-1</code>, you would run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Show the available nodes</span>
sudo<span class="w"> </span>slicer<span class="w"> </span>vm<span class="w"> </span>list<span class="w"> </span>--url<span class="w"> </span>http://127.0.0.1:8081/nodes

<span class="c1"># Get a root shell into node 1</span>
sudo<span class="w"> </span>slicer<span class="w"> </span>vm<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--url<span class="w"> </span>http://127.0.0.1:8081/nodes<span class="w"> </span>k3s-agents-1-1
</code></pre></div>
<p>From there you can check the logs of the <code>k3s</code> service via <code>sudo journalctl -u k3s -f</code>.</p>
<h2 id="next-steps">Next steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Now you have a Kubernetes cluster that can scale its capacity up and down with demand.</p>
<p>Why not try out something that scales Pods?</p>
<p><strong>OpenFaaS which scales Pods</strong></p>
<p><a href="https://docs.openfaas.com/deployment/kubernetes/">OpenFaaS Community Edition (CE)</a> is a version of OpenFaaS that can be used for free for personal use, or a limited commercial trial.</p>
<p>Once you've deployed a function you can use something like the <a href="https://github.com/rakyll/hey">hey tool</a> via (<code>arkade get hey</code>) to stress a function, and cause it to scale up.</p>
<p>Learn more about <a href="https://docs.openfaas.com/architecture/autoscaling/">OpenFaaS Autoscaling</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 OpenFaaS Ltd

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/self-actuated/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/selfactuated" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>